---
import Layout from "@layouts/Layout.astro";
import BannerPrincipal from "@components/BannerPrincipal.astro";
import Servicios from "@components/Servicios.astro";
import TrabajosRealizados from "@components/TrabajosRealizados.astro";
import Precios from "@components/Precios.astro";
import Nosotros from "@components/Nosotros.astro";
import Contacto from "@components/Contacto.astro";
import {
  getAboutMe,
  getHeroBanner,
  getPrecios,
  getServicios,
  getTrabajos,
  STRAPI_BASE_URL,
} from "@lib/manager";

const homePageBanner = await getHeroBanner();

const homePageServicios = await getServicios();

const homePageTrabajos = await getTrabajos();

const homePagePrecios = await getPrecios();

const homePageAboutMe = await getAboutMe();
---

<Layout title="Catalina Romo - Estilista">
  <BannerPrincipal homePageBanner={homePageBanner} baseUrl={STRAPI_BASE_URL} />

  <Servicios homePageServicios={homePageServicios} baseUrl={STRAPI_BASE_URL} />

  <TrabajosRealizados
    homePageTrabajos={homePageTrabajos}
    baseUrl={STRAPI_BASE_URL}
  />

  <Precios homePagePrecios={homePagePrecios} />

  <Nosotros homePageAboutMe={homePageAboutMe} baseUrl={STRAPI_BASE_URL} />

  <Contacto />
</Layout>

<script>
  const sections = document.querySelectorAll("section[id]");
  const options = { threshold: 0.5 };

  const observer = new IntersectionObserver((entries) => {
    entries.forEach((entry) => {
      const title = entry.target.querySelector(".title-section");
      if (!title) return;

      if (entry.isIntersecting) {
        //Active Section
        const id = entry.target.getAttribute("id");
        //Update URL hash
        history.replaceState(null, "", `#${id}`);

        //Add active class to menu header
        document.querySelectorAll(".menu-header").forEach((link) => {
          const href = link.getAttribute("href");
          if (href === `#${id}`) {
            link.classList.add("active");
          } else {
            link.classList.remove("active");
          }
        });

        title.classList.add("active-section");
      } else {
        //Inactive Section
        title.classList.remove("active-section");
      }
    });
  }, options);

  sections.forEach((section) => observer.observe(section));
</script>
